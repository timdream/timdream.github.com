"use strict";function ServiceWorkerController(){}function CVApp(){}function CVCipherUI(){this.state="undecrypted"}function CVDecipher(){}if(document.documentElement.classList.remove("no-js"),"timdream.org"===window.location.hostname&&"1"!==window.doNotTrack&&"1"!==navigator.doNotTrack){var _gaq=_gaq||[];_gaq.push(["_setAccount","UA-4623408-2"]),_gaq.push(["_trackPageview"]),function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="https://ssl.google-analytics.com/ga.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()}ServiceWorkerController.prototype={start:function(){"serviceWorker"in navigator?this.check().then(function(){return this.swReg&&(this.swReg.installing||this.swReg.waiting||this.swReg.active)?this.swReg.active?this.swReg.update():void 0:this.install()}.bind(this)).then(function(){this.swReg.addEventListener("updatefound",this),this.showUpdateProgress()}.bind(this)).catch(function(e){console.log(e)}.bind(this)):this.state="notsupported"},check:function(){return navigator.serviceWorker.getRegistration("/").then(function(e){this.swReg=e}.bind(this))},install:function(){return navigator.serviceWorker.register("/service-worker.min.js",{scope:"/"}).then(function(e){this.swReg=e}.bind(this))},remove:function(){this.state="removing",this.swReg.unregister().then(function(e){e?(this.state="uninstalled",this.swReg=null):this.state="installed"}.bind(this))},showUpdateProgress:function(){this.swReg.installing&&navigator.serviceWorker.controller&&(document.documentElement.classList.add("updating"),this.swReg.installing.addEventListener("statechange",this))},handleEvent:function(e){switch(e.type){case"updatefound":this.showUpdateProgress();break;case"statechange":if(e.target.removeEventListener("statechange",this),"redundant"===e.target.state)return void document.documentElement.classList.remove("updating");window.location.reload()}}},window.swController=new ServiceWorkerController,window.swController.start(),CVApp.prototype={start:function(){document.getElementById("print").addEventListener("click",this),document.getElementById("unlock").addEventListener("click",this),this.cipherUI=new CVCipherUI,this.cipherUI.start()},handleEvent:function(e){switch(e.preventDefault(),e.target.id){case"print":window.print();break;case"unlock":this.cipherUI.toggleDialog()}}},CVCipherUI.prototype={start:function(){var e=this.formEl=document.getElementById("unlock-form");e.hidden=!1,e.addEventListener("submit",this),e.addEventListener("reset",this),e.addEventListener("transitionend",this),this.passwordEl=document.getElementById("unlock-password")},toggleDialog:function(){"undecrypted"===this.state&&document.body.classList.toggle("unlock-dialog")},handleEvent:function(e){if("undecrypted"===this.state)switch(e.type){case"transitionend":this.passwordEl.focus();break;case"submit":this.decrypt(),document.body.classList.remove("unlock-dialog"),e.preventDefault();break;case"reset":document.body.classList.remove("unlock-dialog")}},decrypt:function(){this.state="decrypting",document.body.classList.add("decrypting");var e=document.getElementById("unlock-password").value;document.getElementById("unlock-password").value="";var t=new CVDecipher;t.onloadend=this.decipherLoadEnd.bind(this),t.load(e)},decipherLoadEnd:function(e){switch(document.body.classList.remove("decrypting"),e.type){case"error":alert("Sorry, there were some problem decrypting the information. Please try a different device?\n\nError: "+e.message+"\nDecipher type: "+e.decipherName),this.state="undecrypted";break;case"result":if(e.data.error){alert(e.data.error),this.state="undecrypted";break}var t=e.data.privatePDFBlob,n=window.URL.createObjectURL(t);document.getElementById("download-private").href=n,e.data.domModifications.forEach(function(e){document.getElementById(e.id)[e.prop]=e.value}),this.state="decrypted",document.body.classList.add("decrypted")}}},CVDecipher.prototype={useWebCrypto:!!(window.crypto&&window.crypto.subtle&&window.crypto.subtle.deriveKey),onloadend:null,load:function(e){var t;this.useWebCrypto?(t=this.worker=new Worker("/assets/webcrypto-decipher.min.js?_=ae158a"),this.decipherName="Web Crypto Decipher"):(t=this.worker=new Worker("/assets/asmcrypto-decipher.min.js?_=1c2571"),this.decipherName="asmCrypto Decipher"),t.postMessage({password:e}),t.addEventListener("message",this),t.addEventListener("error",this)},handleEvent:function(e){if("error"===e.type||"error"===e.data.type)return this.onloadend({type:"error",message:e.data?e.data.message:e.message,decipherName:this.decipherName}),void this.worker.terminate();this.onloadend({type:"result",data:e.data})}};var app=new CVApp;app.start();
//# sourceMappingURL=cv.min.js.map